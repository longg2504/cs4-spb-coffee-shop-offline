<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/assets/bootstrap/v.5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/fontawesome/v-5.15.4/css/all.min.css">
</head>

<body>
<div class="container-fluid">
    <div class="col-md-7">
        <div class="container-left">
            <div class="header">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item col-3" role="presentation">
                        <button class="nav-link active col-12" id="table-tab" data-bs-toggle="tab"
                                data-bs-target="#table-pannel"
                                type="button" role="tab" aria-controls="table-pannel" aria-selected="true"><i
                                class="fas fa-tablets" style="margin-right: 5px"></i>Bàn
                        </button>
                    </li>
                    <li class="nav-item col-3" role="presentation">
                        <button class="nav-link col-12" id="menu-tab" data-bs-toggle="tab" data-bs-target="#menu-pannel"
                                type="button" role="tab" aria-controls="menu-pannel" aria-selected="false"><i
                                class="fas fa-book-open" style="margin-right: 5px;"></i>Menu
                        </button>
                    </li>
                </ul>
            </div>
            <div class="container-content" id="container-content-left">
                <div id="div-search-product" class="search d-flex justify-content-end hide">
                    <input type="text" id="searchProduct">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            Dropdown button
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </div>
                    <button class="btn btn-outline-secondary"><i class="fas fa-search"></i>search</button>
                </div>

                <div class="content">
                    <div class="tab-content" id="tabContent">
                        <div class="tab-pane fade show active" id="table-pannel" role="tabpanel"
                             aria-labelledby="table-tab"
                             tabindex="0">

                        </div>
                        <div>

                        <div class="tab-pane fade hide" id="menu-pannel" role="tabpanel" aria-labelledby="menu-tab"
                             tabindex="0">


                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="container-right">
            <div class="header">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item col-3" role="presentation">
                        <button class="nav-link active col-12" id="table-current" data-bs-toggle="tab"
                                data-bs-target="#table-pannel"
                                type="button" role="tab" aria-controls="table-pannel" aria-selected="true">
                            <i class="fas fa-tablets" style="margin-right: 5px"></i><span>Bàn</span>
                        </button>
                    </li>
                </ul>
            </div>

            <div class="container-content">
                <div class="wrapper-content text-center" style="height: 580px;">
                    <div class="content" style="height: 100%;overflow: hidden;background-color: rgba(0, 8, 16, 0.04); ">
                        <div class="board" style="height: 580px;">
                            <i class="fas fa-mug-hot"></i>
                            <p class="title">Chưa có order nào </p>
                            <p class="title-complaint">Vui lòng chọn bàn hoặc món trong menu</p>

                        </div>
                        <div class="content-items hide">

                        </div>
                    </div>

                    <div class="wrapper-footer">
                        <div class="wrapper-footer-header">
                            <span>Tổng tiền</span>
                            <span id="totalAmount">0 vnd</span>
                        </div>
                        <div class="wrapper-footer-btn mt-5">
                            <button type="button" class="btn btn-success" id="btnCreateProduct">
                                <i class="fas fa-money-bill"></i>Thanh Toán
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<th:block th:replace="shop/modalProductDetail"/>
</body>
<script src="/assets/jquery/jquery-3.7.0.min.js"></script>
<script src="/assets/js/jquery.validate.min.js"></script>
<script src="/assets/bootstrap/v.5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="/assets/js/app.js"></script>




<script>
    const page = {
        url: {
            getAllProducts: "http://localhost:9000/api/products",
            getALLTabOrders: "http://localhost:9000/api/tableOrders",
            getProductById: 'http://localhost:9000/api/products',
            getOrderDetailsByTableId: 'http://localhost:9000/api/orders/table',
            getOrderByTableId : 'http://localhost:9000/api/orders/table',
            getProductByName:"http://localhost:9000/api/products/searchName"
        },
        elements: {},
        loadData: {},
        commands: {},
        dialogs: {
            elements: {},
            commands: {}
        },
        initializeControlEvent: {}
    }

    page.elements.btnNavLink = $('.nav-tabs button.nav-link');
    page.elements.menuTab = $('#menu-tab');
    page.elements.tablePannel = $('#table-pannel');
    page.elements.menuPannel = $('#menu-pannel');
    page.elements.menuPannelContents = $('#menu-pannel .contents');
    page.elements.Search = $('#container-content-left');
    page.elements.divSearchProduct = $('#div-search-product');
    page.elements.boardWaiting = $('.board');
    page.elements.contentItems = $('.content-items');
    page.elements.btnShowHide = $('#btnShowHide');
    page.elements.tabHeader = $('.tab-header');
    page.elements.tabContentItem = $('.tab-content-item');
    page.elements.wrapperFooter = $('.wrapper-footer');
    page.elements.tableCurrent = $('#table-current');
    page.elements.btnShowProductDetailModal = $('#btnShowProductDetailModal');
    page.elements.tableCurrent = $('#table-current');
    page.elements.btnShowProductDetailModal = $('#btnShowProductDetailModal');

    page.dialogs.elements.modalProductDetail = $('#modalProductDetail');

    page.elements.searchProduct = $('#searchProduct');


    let product = new Product();
    let tableOrder = new TableOrder();
    let category = new Category();

    page.commands.renderTable = (tableOrder) => {

        return `
            <div class="container-tab-item col-3" data-id="${tableOrder.id}">
              <div  class="tab-header text-center ${tableOrder.status === 'EMPTY' ? '' : 'busy'}">
                <button style="border: none; background-color: none; padding: 5px ; border-radius: 50%;">
                  <i class="fas fa-coffee"></i>
                </button>
              </div>
              <div class="tab-content-item  text-center ${tableOrder.status === 'EMPTY' ? '' : 'busy'}">
                <span>${tableOrder.status}</span>
                <p>${tableOrder.title}</p>
               </div>
            </div>
        `
    }

    page.commands.renderProduct = (product) => {
        const avatar = product.avatar
        return `
            <div class="container-product-item"  data-id="${product.id}">
                  <div   class="image-product" style="height: 180px ;width: 180px;">
                      <img src="${avatar.fileUrl}" style="height: 100%; width: 100%">
                  </div>
                  <div class="content-product text-center">
                      <div class="product-title" >
                          ${product.title}
                      </div>
                      <div class="product-title-bottom">
                      <span>
                          ${product.price}
                      </span>
                      <span>
                        ${product.unit}
                      </span>
                      </div>
                  </div>
                </div>
  `
    }

    page.commands.renderOrderDetail = (obj) => {
        return `
        <div class="item d-flex">
            <div class="image">
                <img src="${obj.avatar.fileUrl}"
                     alt="">
            </div>
            <div class="item-content">
                <div class="title-close d-flex justify-content-between">
                    <span>${obj.title}</span>
                    <button>
                        <span>X</span>
                    </button>
                </div>
                <div class="price-quantity d-flex justify-content-between">
                    <span>Gia : ${obj.price}</span>
                    <form action="">
                        <div class="quantity d-flex">
                            <button type="button"><i class="fas fa-minus"></i></button>
                            <span>${obj.quantity}</span>
                            <button type="button"><i class="fas fa-plus"></i></button>
                        </div>
                    </form>
                    <span>${obj.amount}</span>
                </div>
                <div class="note d-flex">
                    <span>Note: ${obj.note}</span>
                </div>
            </div>
        </div>
        `;
    }

    page.commands.getAllTable = () => {
        $.ajax({
            type: 'GET',
            url: page.url.getALLTabOrders
        })
            .done((data) => {
                    page.elements.tablePannel.empty();
                    data.forEach(item => {
                        tableOrder = item;
                        let str = page.commands.renderTable(tableOrder)
                        page.elements.tablePannel.prepend(str)

                    })

            })
    }

    page.commands.getAllProduct = () => {
        page.elements.menuPannel.empty();
        $.ajax({
            type: 'GET',
            url: page.url.getAllProducts
        })
            .done((data) => {
                data.forEach(item => {
                    product = item;
                    const str = page.commands.renderProduct(product)
                    page.elements.menuPannel.prepend(str);
                })
            })
    }

    page.commands.getProductById = (productId) => {
        return $.ajax({
            type: 'GET',
            url: page.url.getProductById + '/' + productId
        })

    }

    page.commands.getOrderDetailsByTableId = (tableId) => {
        $.ajax({
            type: 'GET',
            url: page.url.getOrderDetailsByTableId + '/' + tableId
        })
            .done((data) => {
                console.log(data)
                if (data && data.length > 0) {
                    page.elements.contentItems.empty();

                    let totalAmount = 0;
                    $.each(data, (index, item) => {
                        const str = page.commands.renderOrderDetail(item);
                        page.elements.contentItems.append(str);
                        totalAmount += item.amount;
                    })

                    $('#totalAmount').text(totalAmount + ' vnd')


                    page.elements.boardWaiting.addClass('hide');
                    page.elements.contentItems.removeClass('hide');
                }
                else {
                    page.elements.boardWaiting.removeClass('hide');
                    page.elements.contentItems.addClass('hide');

                    $('#totalAmount').text('0 vnd')
                }
            })
            .fail((jqXHR) => {
                console.log(jqXHR)
                page.elements.boardWaiting.removeClass('hide');
                page.elements.contentItems.addClass('hide');
            })
    }

    page.commands.getProductByName = () =>  {
        let searchProduct = page.elements.searchProduct.val();
        page.elements.menuPannel.empty();
        if (searchProduct == null) {
            $.ajax({
                type: 'GET',
                url: page.url.getAllProducts + "/" +searchProduct
            })
                .done((data) => {
                    console.log(data)
                    data.forEach(item => {
                        product = item;
                        const str = page.commands.renderProduct(product)
                        page.elements.menuPannel.prepend(str);
                    })
                })
        }
        else{
            $.ajax({
                type: 'GET',
                url: page.url.getProductByName + "/" +searchProduct
            })
                .done((data) => {
                    console.log(data)
                    data.forEach(item => {
                        product = item;
                        const str = page.commands.renderProduct(product)
                        page.elements.menuPannel.prepend(str);
                    })
                })
        }

    }

    page.commands.handleAddEventShowProductDetail = () => {
        page.dialogs.elements.modalProductDetail.modal('show');
    }

    page.commands.showHideSearchDiv = () => {
        if (page.elements.menuPannel.hasClass('active','show')) {
            page.elements.divSearchProduct.removeClass('hide');
        }
        else {
            page.elements.divSearchProduct.addClass('hide');
        }
    }

    page.loadData = () => {
        page.commands.getAllTable();

        page.commands.getAllProduct();
    }

    page.initializeControlEvent = () => {
        const tabEl = document.querySelector('button[data-bs-toggle="tab"]')
        tabEl.addEventListener('shown.bs.tab', event => {
            event.target // newly activated tab
            event.relatedTarget // previous active tab
        })


        page.elements.tablePannel.on('click', '.container-tab-item', function() {
            const tableId = $(this).data('id');
            page.elements.tableCurrent.find('span').text('Bàn ' + tableId);
            page.commands.getOrderDetailsByTableId(tableId);
        })


        page.elements.menuPannel.on('click', '.container-product-item', function() {
            const productId = $(this).data('id');

            page.commands.getProductById(productId).then((data) => {
                $('#frmProductDetail').empty();
                let str = `
                <div class="col-6 mb-3 text-center">
                    <div class="col-12">
                        <span style="font-size: 24px">${data.title}</span>
                        <div class="imageProductDetail">
                            <img style="height: 100%;width: 100%;" src="${data.avatar.fileUrl}" alt="">
                        </div>
                        <p style="font-size: 24px">Tong <span>${totalAmount}</span></p>
                    </div>
                </div>
                <div class="col-6 mb-5 mr-3" style="margin-left: 15px">
                    <div class="col-12" style="margin-top:28px">
                        <p   style="font-size: 22px">${data.title}</p>
                        <div class="price">
                            <p>Giá : <span>${data.price}</span></p>
                        </div>
                        <div class="quantityProductDetail">
                            <p>
                                Số Lượng
                                <span>
                                    <input id="quantity" class="col-6" type="number" min="1" max="20" value="1">
                                </span>
                            </p>

                        </div>
                        <div class="unit">
                            <p>Đơn Vị : <span>${data.unit}</span></p>
                        </div>
                        <div class="note">
                            <label for="note">Ghi Chu <input type="text" id="note"></label>
                        </div>
                    </div>
                </div>
               `;

                $('#frmProductDetail').append(str);

                page.commands.handleAddEventShowProductDetail();


            });


        })


        page.elements.searchProduct.on('change' , function () {
            page.commands.getProductByName();
        })

        page.elements.btnNavLink.on('click', () => {
            page.commands.showHideSearchDiv();
        })


        page.elements.tablePannel.on('click', '.tab-content-item', () => {
            page.elements.menuTab.trigger('click');
            page.commands.showHideSearchDiv();
        })

        page.elements.btnShowProductDetailModal.on('click' , () => {
            page.commands.handleAddEventShowProductDetail();
        })
    }

    $(() => {
        page.loadData();

        page.initializeControlEvent();
    })


</script>

</html>